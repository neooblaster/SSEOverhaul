function SSE(b,c,a){this.SSEName=b;this.SSE_target=(c!==undefined)?c:null;this.defaultCallback=(a!==undefined)?a:null;this.core=null;this.eventsToAppend=[];this.consoleActivated=false;this.SSE_workaround=null;this.timeout_autoDetection=true;this.timeout_delay=60000;this.timeout_detected=false;this.timeout_restart=true;this.timeout_response=0;this.timeout_sample=0;this.timeout_watcherInstance=null;this.timeout_watcherUseSpeed=1000;this.timeout_watcherSetSpeed=1000;this.appendEvents=function(){for(var f=0;f<this.eventsToAppend.length;f++){var e=this.eventsToAppend[f].eventName;var d=this.eventsToAppend[f].eventFunction;this.core.addEventListener(e,d)}return true};this.addEvent=function(e,d){var f=false;for(var g=0;g<this.eventsToAppend.length;g++){if(this.eventsToAppend[g].eventName===e){this.eventsToAppend[g].eventFunction=d;this.sendWarn("L'évenement \""+e+'" à été mise à jour.');f=true;break}}if(!f){this.eventsToAppend.push({eventName:e,eventFunction:d});this.sendLog("L'évenement \""+e+'" à été ajouté à la liste.')}return this};this.callback=function(d){this.defaultCallback=d;this.sendLog("Définition de la fonction de traitement par défaut [defaultCallback].");return this};this.consoleOff=function(){this.consoleActivated=false;console.log('Désactivation des sorties "console".');return this};this.consoleOn=function(){this.consoleActivated=true;this.sendLog('Activation des sorties "console".');return this};this.getFunctionName=function(d){var e=null;d=String(d);d=d.substr(9);var f=d.indexOf("(");e=d.substr(0,f);return e};this.removeEvent=function(d){var e=false;for(var f=0;f<this.eventsToAppend.length;f++){if(this.eventsToAppend[f].eventName===d){e=true}}if(e){var g=[];for(var f=0;f<this.eventsToAppend.length;f++){if(this.eventsToAppend[f].eventName!=d){g.push({eventName:this.eventsToAppend[f].eventName,eventFunction:this.eventsToAppend[f].eventFunction})}}this.eventsToAppend=g;this.sendLog("L'évenement \""+d+'" a bien été retiré de la liste des évenements.');return this}else{this.sendWarn("L'évenement \""+d+"\" n'existe pas dans la liste. Aucune suppresion n'a été effectuée.");return this}};this.restart=function(){if(this.core!==null){this.stop();this.start();this.sendLog("Redémarrage terminé.");return this}else{this.sendWarn("Aucune connexon active. Pas de redémarrage effectué.");return this}};this.sendLog=function(d){if(this.consoleActivated){console.log('SSE "'+this.SSEName+'" :: '+d);return true}return false};this.sendWarn=function(d){if(this.consoleActivated){console.warn('SSE "'+this.SSEName+'" :: '+d);return true}return false};this.sendError=function(d){console.error('SSE "'+this.SSEName+'" :: '+d);return true};this.setTimeoutDelay=function(d){this.timeout_delay=d;this.timeout_autoDetection=false;this.timeout_detected=true;this.sendLog("Le délais du timeout à été définie à "+d+"ms.");return this};this.setTimeoutRestart=function(d){this.timeout_restart=d;if(d){this.sendLog("En cas de connexion aborted, une reconnexion automatique aura lieu.")}else{this.sendWarn("En cas de connexion aborted, il n'y aura pas de reconnexion automatique.")}return this};this.start=function(){if(window.EventSource===undefined){this.sendWarn("Les Server-Sent Events sont incompatible avec votre navigateur.");if(this.SSE_workaround!==null){this.sendWarn('Le programme bascule sur la fonction alternative "'+this.getFunctionName(this.SSE_workaround)+'".');this.SSE_workaround()}else{this.sendError("Du à l'incompatibilité de votre navigateur et à l'absence de traitement alternatif, vous ne pouvez pas utiliser l'application.");alert("Du à l'incompatibilité de votre navigateur et à l'absence de traitement alternatif, vous ne pouvez pas utiliser l'application.")}}else{var d=true;if(this.SSE_target===null){this.sendError("Connexion impossible, source non définie [target].");d=false}if(this.defaultCallback===null){this.sendError("Connexion impossible, fonction de traitement (callback) non définie [defaultCallback].");d=false}if(d){if(this.core===null){this.core=new EventSource(this.SSE_target);this.core.onmessage=function(e){if(!this.timeout_detected&&this.timeout_autoDetection){if(this.timeout_sample!==0){this.timeout_delay=Math.ceil(1.1*(Date.now()-this.timeout_sample));this.timeout_detected=true;this.sendLog("La detection automatique du délais de timeout à été définie à "+this.timeout_delay+"ms.")}else{this.timeout_sample=Date.now()}}this.timeout_response=Date.now();this.defaultCallback(e)}.bind(this);this.appendEvents();if(this.timeout_restart){this.timeout_watcherInstance=setInterval(this.timeout_watcher.bind(this),this.timeout_watcherUseSpeed)}this.sendLog('Connexion à la cible "'+this.SSE_target+'" établie.')}else{this.sendWarn("Connexion déjà établie.")}}}};this.stop=function(){if(this.core===null){this.sendWarn("Aucune connexion à fermer.");return this}else{this.core.close();this.core=null;if(this.timeout_watcherInstance!==null){clearInterval(this.timeout_watcherInstance);this.timeout_watcherInstance=null}this.sendLog("La connexion à bien été fermée.");return this}};this.target=function(d){this.SSE_target=d;this.sendLog('Définition de la source à "'+d+'" [target].');return this};this.timeout_watcher=function(){var e=Date.now();var d=e-this.timeout_response;if(d>this.timeout_delay&&this.timeout_restart){this.sendWarn("Le délais entre deux réponses est passé. Le programme effectue une reconnexion.");this.restart()}if(this.timeout_watcherSetSpeed!==this.timeout_watcherUseSpeed){this.timeout_watcherSetSpeed=this.timeout_watcherUseSpeed;clearInterval(this.timeout_watcherInstance);this.timeout_watcherInstance=setInterval(this.timeout_watcher.bind(this),this.timeout_watcherUseSpeed)}};this.workaround=function(d){this.SSE_workaround=d;this.sendLog('La fonction "'+this.getFunctionName(d)+'" sera utilisé par les navigateur non compatible aux Server-Sent Events.');return this};return this};